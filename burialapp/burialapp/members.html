<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSHILAPFENE BURIAL SOCIETY - Members</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/custom.css">

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>
    
    <!-- Modals -->
    <div id="editChoiceModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-edit"></i> Edit Options</h3>
            <p>What would you like to edit for this member?</p>
            <div class="modal-buttons">
                <button id="choiceEditMember" class="btn btn-orange"><i class="fas fa-user-edit"></i> Edit Member</button>
                <button id="choiceEditBen" class="btn btn-green"><i class="fas fa-users"></i> Edit Beneficiaries</button>
                <button id="choiceCancel" class="btn btn-ghost"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>
    
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-circle"></i> Confirm Deletion</h3>
            <p>Are you sure you want to delete this member? This action cannot be undone.</p>
            <div class="modal-buttons">
                <button id="confirmDeleteBtn" class="btn btn-red"><i class="fas fa-check"></i> Delete</button>
                <button id="cancelDeleteBtn" class="btn btn-ghost"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>
    
    <div id="beneficiaryModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-user-plus"></i> Add Beneficiary</h3>
            <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                <input type="text" id="beneficiaryName" placeholder="Beneficiary Full Name" required class="modal-input">
                <input type="text" id="beneficiaryIdNumber" placeholder="Beneficiary ID Number" required class="modal-input">
                <input type="text" id="beneficiaryRelationship" placeholder="Relationship to Member" required class="modal-input">
                <input type="text" id="beneficiaryPhone" placeholder="Phone Number" class="modal-input">
                <input type="text" id="beneficiaryAddress" placeholder="Address" class="modal-input">
            </div>
            <div class="modal-buttons">
                <button id="saveBeneficiaryBtn" class="btn btn-green"><i class="fas fa-save"></i> Save</button>
                <button id="cancelBeneficiaryBtn" class="btn btn-ghost"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <div id="manageBeneficiariesModal" class="modal">
        <div class="modal-content" style="max-width: 800px; width: 90%;">
            <h3><i class="fas fa-users"></i> Manage Beneficiaries</h3>
            <div style="margin-top: 20px;">
                <div id="beneficiariesList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Beneficiaries will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-buttons">
                <button id="addNewBeneficiaryBtn" class="btn btn-green"><i class="fas fa-user-plus"></i> Add Beneficiary</button>
                <button id="closeBeneficiariesBtn" class="btn btn-ghost"><i class="fas fa-times"></i> Close</button>
            </div>
        </div>
    </div>

    <div id="editBeneficiaryModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-user-edit"></i> Edit Beneficiary</h3>
            <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                <div style="padding: 10px; background-color: rgba(255,255,255,0.05); border-radius: 4px;">
                    <strong style="color: #888;">Beneficiary ID:</strong> <span id="editBeneficiaryId" style="color: #fff;">-</span>
                </div>
                <input type="text" id="editBeneficiaryName" placeholder="Beneficiary Full Name" required class="modal-input">
                <input type="text" id="editBeneficiaryIdNumber" placeholder="Beneficiary ID Number" required class="modal-input">
                <input type="text" id="editBeneficiaryRelationship" placeholder="Relationship to Member" required class="modal-input">
                <input type="text" id="editBeneficiaryPhone" placeholder="Phone Number" class="modal-input">
                <input type="text" id="editBeneficiaryAddress" placeholder="Address" class="modal-input">
            </div>
            <div class="modal-buttons">
                <button id="saveEditBeneficiaryBtn" class="btn btn-green"><i class="fas fa-save"></i> Save Changes</button>
                <button id="cancelEditBeneficiaryBtn" class="btn btn-ghost"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <div id="deleteBeneficiaryModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-circle"></i> Confirm Deletion</h3>
            <p>Are you sure you want to delete this beneficiary? This action cannot be undone.</p>
            <div class="modal-buttons">
                <button id="confirmDeleteBeneficiaryBtn" class="btn btn-red"><i class="fas fa-check"></i> Delete</button>
                <button id="cancelDeleteBeneficiaryBtn" class="btn btn-ghost"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <div id="editMemberModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-user-edit"></i> Edit Member</h3>
            <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                <div style="padding: 10px; background-color: rgba(255,255,255,0.05); border-radius: 4px;">
                    <strong style="color: #888;">Member ID:</strong> <span id="editMemberId" style="color: #fff;">-</span>
                </div>
                <input type="text" id="editMemberNumber" placeholder="Member Number" class="modal-input">
                <input type="text" id="editName" placeholder="Full Name" required class="modal-input">
                <input type="text" id="editIdNumber" placeholder="ID Number" required class="modal-input">
                <input type="text" id="editPhone" placeholder="Phone Number" required class="modal-input">
            </div>
            <div class="modal-buttons">
                <button id="saveMemberEdit" class="btn btn-green"><i class="fas fa-save"></i> Save Changes</button>
                <button id="cancelMemberEdit" class="btn btn-ghost"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="app-container">
        <div class="content active" id="members">
            <button class="back-button" id="backToHomeFromMembers" onclick="window.location.href='index.html'">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>
            <div class="section-header">
                <h2><i class="fas fa-users"></i> Members Management</h2>
                <div class="export-buttons">
                    <button class="export-btn" id="exportPDF">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button class="export-btn" id="exportExcel">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                </div>
            </div>
            <p class="small-muted">Register new members and manage their beneficiaries with ease.</p>

            <div class="form-search-container">
                <form id="memberForm">
                    <input type="text" id="memberNumber" placeholder="Member Number">
                    <input type="text" id="name" placeholder="Full Name" required>
                    <input type="text" id="idNumber" placeholder="ID Number" required>
                    <input type="text" id="phone" placeholder="Phone Number" required>

                    <button type="submit" id="memberSubmit" class="add-btn-green">
                        <i class="fas fa-plus"></i> Add Member
                    </button>
                </form>

                <input type="text" id="memberSearch" placeholder="Search by name or member number...">
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Member Number</th>
                        <th>Full Name</th>
                        <th>ID Number</th>
                        <th>Phone</th>
                        <th>Beneficiaries</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="memberList"></tbody>
            </table>
        </div>
    </div>

    <!-- ========================================================================== -->
    <!-- SCRIPT LOADING ORDER - DO NOT CHANGE WITHOUT CAREFUL CONSIDERATION       -->
    <!-- ========================================================================== -->
    <!--
        This modular architecture ensures clean separation of concerns:
        1. Configuration loaded first (constants, magic strings)
        2. Utilities available to all modules (helpers, storage)
        3. Core services (auth, base HTTP client)
        4. Domain API services (member & beneficiary operations)
        5. UI modules (rendering and DOM manipulation)
        6. Event modules (user interaction handlers)
        7. Main orchestrator (coordinates everything)
    -->

    <!-- 1. Configuration - Must load first -->
    <script src="/assets/js/config/constants.js"></script>

    <!-- 2. Utilities - Required by all other modules -->
    <script src="/assets/js/utils/helpers.js"></script>
    <script src="/assets/js/utils/storage.js"></script>

    <!-- 3. Core Services - Base functionality -->
    <script src="/assets/js/base.js"></script>
    <script src="/assets/js/auth.js"></script>
    <script src="/assets/js/services/apiService.js"></script>

    <!-- 4. API Services - Domain-specific API calls -->
    <script src="/assets/js/services/memberService.js"></script>
    <script src="/assets/js/services/beneficiaryService.js"></script>

    <!-- 5. UI Modules - Rendering and DOM manipulation -->
    <script src="/assets/js/modules/memberUI.js"></script>
    <script src="/assets/js/modules/beneficiaryUI.js"></script>

    <!-- 6. Event Modules - User interaction handlers -->
    <script src="/assets/js/modules/memberEvents.js"></script>
    <script src="/assets/js/modules/beneficiaryEvents.js"></script>

    <!-- 7. Main Orchestrator - Coordinates all modules (loads last) -->
    <script src="/assets/js/members.js"></script>
</body>
</html>